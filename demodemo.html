<!DOCTYPE html>
<html lang="jp">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SpeechDemo</title>
</head>

<body>
    <canvas id="cv" width="1024" height="768"></canvas>
    <script>
        const cvs = document.getElementById('cv');
        const ctx = cvs.getContext('2d');

        let text = "";
        let check;

        SpeechRecognition = webkitSpeechRecognition || SpeechRecognition; //ChromeとFirefoxで音声デバイス許可しますか？のヤツ
        const recognition = new SpeechRecognition();　//WebAPIが使えるようになるよ
        recognition.lang = 'ja'; //認識言語設定
        recognition.start();
        recognition.continuous = true;  //録音を続ける

        window.onload = () => {
            ctx.font = "24px Arial";
            ctx.fillStyle = "black";
            ctx.fillText("STARTと言ってみて", 1024 / 2, 768 / 2);
            SpeechRecord();
        }

        recognition.onend = function () {
            if (!check) {
                recognition.start();
            }
        }

        function SpeechRecord() {
            recognition.onresult = function (e) {
                if (e.results[e.resultIndex].isFinal) {
                    text = e.results[e.resultIndex][0].transcript;
                    console.log(text);
                    console.log(e.results);
                    TextCheck();
                }
            }
        }

        function TextCheck() {
            let reg = new RegExp(/スタート/);
            check = reg.test(text);
            console.log(check);
            if (check) {
                selectMode();
            } else {
                SpeechRecord();
            }
        }

        //モード選択のウィンドウの描画
        function drawMode() {
            //var WIN_X = 335;
            //var WIN_Y = 340;
            //ctx.beginPath();
            ctx.fillStyle = "white";
            ctx.fillRect(370, 430, 300, 250);
            ctx.strokeStyle = "black";
            ctx.lineWidth = 5;
            ctx.strokeRect(370, 430, 300, 250);

            ctx.font = 'bold 24pt Arial';
            ctx.fillStyle = 'black';
            ctx.fillText('あそぶモードを', 400, 490);
            ctx.fillText('教えてね', 400, 530);
            ctx.fillText('OITモード', 420, 590);
            ctx.fillText('ムゲンモード', 420, 630);
            //ctx.closePath();
        }

        function selectMode() {
            drawMode();
        }

    </script>

</body>

</html>